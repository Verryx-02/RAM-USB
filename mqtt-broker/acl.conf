# Mosquitto Access Control List for R.A.M.-U.S.B. Monitoring System
# Defines topic permissions based on client certificate Common Names
#
# Security Model:
# - Publishers can only write to their specific service topic
# - Subscriber can only read from metrics/* topics
# - No wildcard publishing allowed
# - No access to $SYS topics for security

# ===========================
# SERVICE PUBLISHERS
# ===========================
# Each service can only publish to its own metrics topic
# This prevents spoofing of metrics from other services

# Entry-Hub Publisher
# Certificate CN: entry-hub-mqtt-publisher
user entry-hub-mqtt-publisher
topic write metrics/entry-hub

# Security-Switch Publisher
# Certificate CN: security-switch-mqtt-publisher
user security-switch-mqtt-publisher
topic write metrics/security-switch

# Database-Vault Publisher
# Certificate CN: database-vault-mqtt-publisher
user database-vault-mqtt-publisher
topic write metrics/database-vault

# Storage-Service Publisher (future)
# Certificate CN: storage-service-mqtt-publisher
user storage-service-mqtt-publisher
topic write metrics/storage-service

# ===========================
# METRICS COLLECTOR SUBSCRIBER
# ===========================
# Can read all metrics but cannot publish

# Metrics-Collector Subscriber
# Certificate CN: metrics-collector-subscriber
user metrics-collector-subscriber
topic read metrics/+
topic read metrics/#

# Deny write access to metrics collector
user metrics-collector-subscriber
topic deny metrics/+
topic deny metrics/#

# ===========================
# ADMIN/DEBUG ACCESS
# ===========================
# Admin certificate for debugging (optional)
# Should be disabled in production

# Admin User (if certificate exists)
# Certificate CN: mqtt-admin
# user mqtt-admin
# topic readwrite #

# ===========================
# DEFAULT DENY RULE
# ===========================
# Default deny for unmatched users/topics
# Any certificate not listed above will be denied
user *
topic deny #